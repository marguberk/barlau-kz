# Инструкция по сборке iOS-приложения с Apache Cordova

В данной инструкции описаны шаги по настройке, сборке и публикации iOS-приложения для BARLAU.KZ с использованием фреймворка Apache Cordova.

## Предварительные требования

Для сборки iOS-приложения с помощью Cordova вам потребуется:

1. **Компьютер Mac** с macOS 10.15 Catalina или новее
2. **Xcode 12** или новее (установите из App Store)
3. **Node.js** и **npm** (рекомендуется использовать Node.js 14+)
4. **Аккаунт Apple Developer** (платная подписка $99/год)
5. **Command Line Tools для Xcode** (устанавливаются через `xcode-select --install`)

## Установка необходимых инструментов

1. **Установка Cordova CLI**:
   ```bash
   npm install -g cordova
   ```

2. **Установка инструмента для генерации ресурсов**:
   ```bash
   npm install -g cordova-res
   ```

## Шаг 1: Настройка проекта Cordova

1. **Перейдите в директорию с проектом Cordova**:
   ```bash
   cd cordova-barlau
   ```

2. **Установите зависимости проекта**:
   ```bash
   npm install
   ```

3. **Добавьте платформу iOS** (если она еще не добавлена):
   ```bash
   cordova platform add ios
   ```

4. **Проверьте, что все требования для сборки выполнены**:
   ```bash
   cordova requirements ios
   ```
   
   Вы должны увидеть примерно такой результат:
   ```
   Requirements check results for ios:
   Apple macOS: installed darwin
   Xcode: installed 13.2.1
   ios-deploy: installed 1.11.4
   CocoaPods: installed 1.11.2
   ```

## Шаг 2: Подготовка ресурсов (иконки и сплэш-экраны)

1. **Разместите базовые изображения в правильных директориях**:
   - Поместите логотип (1024×1024 px) в `cordova-barlau/www/img/logo.png`
   - Для сплэш-экрана создайте изображение (2732×2732 px) и сохраните его как `cordova-barlau/res/splash.png`

2. **Сгенерируйте ресурсы для iOS**:
   ```bash
   cordova-res ios --skip-config --copy
   ```

   Это создаст все необходимые размеры иконок и сплэш-экранов в директории `res/ios/`.

## Шаг 3: Сборка приложения

1. **Создайте отладочную сборку для проверки**:
   ```bash
   cordova build ios
   ```

2. **Откройте проект в Xcode** для настройки подписей и прочих параметров:
   ```bash
   open platforms/ios/BARLAU.xcworkspace
   ```

3. **Настройка в Xcode**:
   - Выберите проект в навигаторе слева
   - В разделе "Signing & Capabilities" выберите ваш Apple Developer аккаунт
   - Убедитесь, что Bundle Identifier соответствует значению в `config.xml` (kz.barlau.app)
   - Настройте команду разработчиков

4. **Тестирование на симуляторе**:
   - Выберите симулятор iOS (например, iPhone 13) в выпадающем меню
   - Нажмите кнопку "Run" (треугольник) для запуска

5. **Тестирование на реальном устройстве**:
   - Подключите iPhone или iPad к компьютеру через USB
   - Выберите ваше устройство в выпадающем меню
   - Нажмите кнопку "Run"
   - На устройстве может потребоваться доверить сертификат разработчика (Settings -> General -> Device Management)

## Шаг 4: Настройка для публикации в App Store

1. **Создайте App ID в Apple Developer Portal**:
   - Перейдите на [Apple Developer Portal](https://developer.apple.com/account)
   - Выберите "Certificates, IDs & Profiles"
   - В разделе "Identifiers" создайте новый App ID с Bundle ID из вашего проекта (kz.barlau.app)
   - Включите необходимые возможности (Push Notifications, Associated Domains и т.д.)

2. **Создайте приложение в App Store Connect**:
   - Перейдите на [App Store Connect](https://appstoreconnect.apple.com/)
   - Выберите "My Apps" и нажмите "+" для создания нового приложения
   - Укажите Bundle ID, имя, SKU и другую необходимую информацию

3. **Настройка дополнительной информации в App Store Connect**:
   - Загрузите скриншоты для различных устройств
   - Заполните описание, ключевые слова, URL поддержки
   - Выберите категорию (например, "Бизнес" или "Производительность")
   - Заполните информацию о конфиденциальности

## Шаг 5: Создание релизной сборки

1. **Создайте релизную версию для загрузки в App Store**:
   ```bash
   cordova build ios --release
   ```

2. **Открытие в Xcode**:
   ```bash
   open platforms/ios/BARLAU.xcworkspace
   ```

3. **Создание архива для App Store**:
   - В Xcode выберите "Generic iOS Device" в выпадающем меню
   - В меню выберите "Product" -> "Archive"
   - После создания архива откроется Organizer с вашим архивом

4. **Валидация и загрузка**:
   - В Organizer нажмите "Validate App" для проверки
   - После успешной валидации нажмите "Distribute App"
   - Выберите "App Store Connect" как метод распространения
   - Следуйте инструкциям мастера загрузки

5. **Финальные шаги в App Store Connect**:
   - Вернитесь в App Store Connect после загрузки сборки
   - Выберите загруженную сборку в разделе "Build"
   - Заполните информацию для проверки приложения (Review Information)
   - Отправьте приложение на проверку

## Шаг 6: Обновление приложения

Для выпуска обновлений:

1. Измените версию в `config.xml` и `package.json`
2. Внесите необходимые изменения в код
3. Повторите процесс сборки и загрузки в App Store

## Полезные советы и рекомендации

1. **Подготовка к проверке Apple**:
   - Убедитесь, что приложение соответствует всем [App Store Review Guidelines](https://developer.apple.com/app-store/review/guidelines/)
   - Если ваше приложение в основном отображает веб-контент, убедитесь, что оно предоставляет нативную функциональность и использует нативные API устройства
   - Подготовьте демо-аккаунт для проверяющих из Apple (если требуется авторизация)

2. **Оптимизация работы**:
   - Используйте Service Workers на веб-сайте для обеспечения офлайн-функциональности
   - Оптимизируйте загрузку веб-страниц для мобильных устройств
   - Интегрируйте нативные возможности (геолокация, камера) для обеспечения нативного опыта

3. **Отладка**:
   - Используйте Safari Web Inspector для отладки WebView (Safari -> Preferences -> Advanced -> Show Develop menu)
   - Проверяйте производительность на различных устройствах и при различных условиях сети

## Устранение распространенных проблем

1. **Проблемы с подписями**:
   - Убедитесь, что вы используете правильный профиль разработчика
   - Проверьте, не истек ли срок действия сертификатов
   - Убедитесь, что Bundle ID совпадает с настроенным в Apple Developer Portal

2. **Проблемы с загрузкой в App Store**:
   - Убедитесь, что версия приложения больше, чем предыдущая загруженная версия
   - Проверьте, что версия в Info.plist совпадает с версией в App Store Connect
   - Убедитесь, что все скриншоты имеют правильные размеры

3. **Проблемы с плагинами**:
   - Проверьте совместимость плагинов с текущей версией Cordova и iOS
   - Обновите плагины до последних версий
   - При необходимости проверьте и модифицируйте нативный код плагинов

## Документация и ресурсы

- [Apache Cordova Documentation](https://cordova.apache.org/docs/en/latest/)
- [Apple Developer Documentation](https://developer.apple.com/documentation/)
- [App Store Review Guidelines](https://developer.apple.com/app-store/review/guidelines/)
- [App Store Connect Help](https://help.apple.com/app-store-connect/) 