<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *; connect-src *">
    <title>Грузовики - BARLAU.KZ</title>
    <link rel="preload" href="img/logo.png" as="image">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        header {
            background: #2563EB;
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 40px;
            margin-right: 10px;
        }
        
        .back-button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 8px 12px;
        }
        
        .back-button:before {
            content: "←";
            margin-right: 5px;
        }
        
        .truck-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            grid-gap: 20px;
            margin: 20px 0;
        }
        
        .truck-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s;
        }
        
        .truck-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .truck-image {
            height: 200px;
            background-color: #e0e0e0;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .truck-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #10B981;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-idle {
            background: #F59E0B;
        }
        
        .status-maintenance {
            background: #EF4444;
        }
        
        .truck-info {
            padding: 15px;
        }
        
        .truck-name {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 5px 0;
        }
        
        .truck-model {
            font-size: 14px;
            color: #666;
            margin: 0 0 10px 0;
        }
        
        .truck-specs {
            margin: 15px 0;
            font-size: 14px;
        }
        
        .truck-spec {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .truck-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .truck-action-btn {
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .truck-action-btn.secondary {
            background: #6B7280;
        }
        
        /* Стили для детальной страницы */
        .truck-detail {
            display: none;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
            padding: 20px;
        }
        
        .truck-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            grid-gap: 10px;
            margin: 20px 0;
        }
        
        .gallery-item {
            height: 150px;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .truck-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .truck-details-title h2 {
            margin: 0;
            font-size: 24px;
        }
        
        .truck-details-title p {
            margin: 5px 0 0 0;
            font-size: 16px;
            color: #666;
        }
        
        .truck-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin: 20px 0;
        }
        
        .truck-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 500;
        }
        
        .truck-tab.active {
            border-bottom-color: #2563EB;
            color: #2563EB;
        }
        
        .truck-tab-content {
            display: none;
        }
        
        .truck-tab-content.active {
            display: block;
        }
        
        .truck-specs-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .truck-specs-table th,
        .truck-specs-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .truck-specs-table th {
            background-color: #f8f9fa;
            font-weight: 500;
        }
        
        .document-list {
            margin: 20px 0;
        }
        
        .document-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        
        .document-info {
            flex: 1;
        }
        
        .document-title {
            font-weight: 500;
            margin: 0 0 5px 0;
        }
        
        .document-date {
            font-size: 14px;
            color: #666;
            margin: 0;
        }
        
        .document-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 15px;
        }
        
        .status-valid {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .status-expiring {
            background: #FEF3C7;
            color: #92400E;
        }
        
        .status-expired {
            background: #FEE2E2;
            color: #B91C1C;
        }
        
        .document-actions {
            margin-left: 10px;
        }
        
        .btn-document {
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
        }
        
        .history-list {
            margin: 20px 0;
        }
        
        .history-item {
            position: relative;
            padding-left: 30px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .history-item:before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2563EB;
        }
        
        .history-date {
            font-weight: 500;
            margin: 0 0 5px 0;
        }
        
        .history-description {
            margin: 0;
            color: #4B5563;
        }
        
        @media (max-width: 768px) {
            .truck-list {
                grid-template-columns: 1fr;
            }
            
            .truck-gallery {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .truck-tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
            }
            
            .truck-details-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .truck-specs-table th,
            .truck-specs-table td {
                padding: 8px 10px;
                font-size: 14px;
            }
        }

        /* Стили для добавления/редактирования */
        .form-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
            padding: 20px;
        }
        
        .form-title {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        
        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .btn-submit {
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .btn-cancel {
            background: #6B7280;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            margin-right: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .file-upload {
            border: 2px dashed #d1d5db;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .file-upload-input {
            display: none;
        }
        
        .file-upload-label {
            display: block;
            cursor: pointer;
        }
        
        .file-upload-icon {
            font-size: 30px;
            color: #6B7280;
            margin-bottom: 10px;
        }
        
        .upload-preview {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .preview-item {
            width: 80px;
            height: 80px;
            margin-right: 10px;
            margin-bottom: 10px;
            background-size: cover;
            background-position: center;
            position: relative;
            border-radius: 4px;
        }
        
        .preview-remove {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: #EF4444;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <button class="back-button" onclick="goBack()">Назад</button>
            <div class="logo">
                <img src="img/logo.png" alt="BARLAU.KZ">
                <h1>Грузовики</h1>
            </div>
            <div></div>
        </div>
    </header>

    <div class="container">
        <div class="truck-list" id="truck-list">
            <!-- Список грузовиков будет загружен динамически -->
        </div>
        
        <div class="truck-detail" id="truck-detail">
            <div class="truck-details-header">
                <div class="truck-details-title">
                    <h2 id="detail-title">Название грузовика</h2>
                    <p id="detail-model">Модель грузовика</p>
                </div>
                <div>
                    <button class="truck-action-btn" onclick="editTruck()">Редактировать</button>
                    <button class="truck-action-btn secondary" onclick="backToList()">Назад к списку</button>
                </div>
            </div>
            
            <div class="truck-tabs">
                <div class="truck-tab active" onclick="showTab('info')">Информация</div>
                <div class="truck-tab" onclick="showTab('documents')">Документы</div>
                <div class="truck-tab" onclick="showTab('history')">История</div>
                <div class="truck-tab" onclick="showTab('photos')">Фотографии</div>
            </div>
            
            <div class="truck-tab-content active" id="tab-info">
                <table class="truck-specs-table">
                    <tr>
                        <th>Государственный номер</th>
                        <td id="detail-registration">-</td>
                    </tr>
                    <tr>
                        <th>Модель</th>
                        <td id="detail-model-full">-</td>
                    </tr>
                    <tr>
                        <th>Год выпуска</th>
                        <td id="detail-year">-</td>
                    </tr>
                    <tr>
                        <th>Грузоподъемность</th>
                        <td id="detail-capacity">-</td>
                    </tr>
                    <tr>
                        <th>Габариты (Д×Ш×В)</th>
                        <td id="detail-dimensions">-</td>
                    </tr>
                    <tr>
                        <th>Объем</th>
                        <td id="detail-volume">-</td>
                    </tr>
                    <tr>
                        <th>Тип кузова</th>
                        <td id="detail-body-type">-</td>
                    </tr>
                    <tr>
                        <th>Состояние</th>
                        <td id="detail-status">-</td>
                    </tr>
                    <tr>
                        <th>Пробег</th>
                        <td id="detail-mileage">-</td>
                    </tr>
                    <tr>
                        <th>Дополнительная информация</th>
                        <td id="detail-notes">-</td>
                    </tr>
                </table>
            </div>
            
            <div class="truck-tab-content" id="tab-documents">
                <div class="document-list" id="document-list">
                    <!-- Документы будут загружены динамически -->
                </div>
                <button class="truck-action-btn" onclick="addDocument()">Добавить документ</button>
            </div>
            
            <div class="truck-tab-content" id="tab-history">
                <div class="history-list" id="history-list">
                    <!-- История будет загружена динамически -->
                </div>
            </div>
            
            <div class="truck-tab-content" id="tab-photos">
                <div class="truck-gallery" id="truck-gallery">
                    <!-- Галерея будет загружена динамически -->
                </div>
                <button class="truck-action-btn" onclick="addPhotos()">Добавить фотографии</button>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <script type="text/javascript" src="js/trucks.js"></script>
    <script>
        // Функции для работы с страницей
        let currentTruckId = null;
        
        // При загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Проверяем наличие ID грузовика в URL
            const urlParams = new URLSearchParams(window.location.search);
            const truckId = urlParams.get('id');
            
            // Проверяем, загружен ли модуль грузовиков
            if (typeof window.TrucksModule === 'undefined') {
                console.error('Модуль TrucksModule не загружен');
                return;
            }
            
            // Инициализируем демо-данные если нужно
            if (window.TrucksModule.getAllTrucks().length === 0) {
                window.TrucksModule.initDemoData();
            }
            
            // Отображаем список грузовиков
            renderTruckList();
            
            // Если указан ID грузовика, отображаем его детали
            if (truckId) {
                showTruckDetails(parseInt(truckId, 10));
            }
            
            // Запускаем синхронизацию с сервером в фоне
            window.TrucksModule.syncTrucksWithServer()
                .then(() => {
                    // Перерисовываем список после синхронизации
                    renderTruckList();
                    
                    // Обновляем детали, если они отображены
                    if (currentTruckId) {
                        showTruckDetails(currentTruckId);
                    }
                })
                .catch(error => {
                    console.error('Ошибка синхронизации:', error);
                });
        });
        
        // Функция рендеринга списка грузовиков
        function renderTruckList() {
            const truckList = document.getElementById('truck-list');
            truckList.innerHTML = '';
            
            const trucks = window.TrucksModule.getAllTrucks();
            
            if (trucks.length === 0) {
                truckList.innerHTML = '<p>Нет доступных грузовиков</p>';
                return;
            }
            
            trucks.forEach(truck => {
                truckList.innerHTML += `
                    <div class="truck-card" onclick="showTruckDetails(${truck.id})">
                        <div class="truck-image" style="background-image: url('${truck.image}')">
                            <div class="truck-status ${getStatusClass(truck.status)}">${getStatusLabel(truck.status)}</div>
                        </div>
                        <div class="truck-info">
                            <h3 class="truck-name">${truck.name}</h3>
                            <p class="truck-model">${truck.model} (${truck.year})</p>
                            <div class="truck-specs">
                                <div class="truck-spec">
                                    <span>Рег. номер:</span>
                                    <span>${truck.registration}</span>
                                </div>
                                <div class="truck-spec">
                                    <span>Грузоподъемность:</span>
                                    <span>${truck.capacity}</span>
                                </div>
                                <div class="truck-spec">
                                    <span>Объем:</span>
                                    <span>${truck.volume}</span>
                                </div>
                            </div>
                            <div class="truck-actions">
                                <button class="truck-action-btn secondary" onclick="event.stopPropagation(); showTruckHistory(${truck.id})">История</button>
                                <button class="truck-action-btn" onclick="event.stopPropagation(); showTruckDetails(${truck.id})">Подробнее</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        // Функция отображения детальной информации о грузовике
        function showTruckDetails(id) {
            currentTruckId = id;
            const truck = window.TrucksModule.getTruckById(id);
            
            if (!truck) {
                alert('Грузовик не найден');
                return;
            }
            
            document.getElementById('detail-title').textContent = truck.name;
            document.getElementById('detail-model').textContent = truck.model;
            document.getElementById('detail-registration').textContent = truck.registration;
            document.getElementById('detail-model-full').textContent = truck.model;
            document.getElementById('detail-year').textContent = truck.year;
            document.getElementById('detail-capacity').textContent = truck.capacity;
            document.getElementById('detail-dimensions').textContent = truck.dimensions;
            document.getElementById('detail-volume').textContent = truck.volume;
            document.getElementById('detail-body-type').textContent = truck.bodyType;
            document.getElementById('detail-status').textContent = getStatusLabel(truck.status);
            document.getElementById('detail-mileage').textContent = truck.mileage;
            document.getElementById('detail-notes').textContent = truck.notes || '-';
            
            renderDocuments(truck.documents);
            renderHistory(truck.history);
            renderGallery(truck.photos);
            
            document.getElementById('truck-list').style.display = 'none';
            document.getElementById('truck-detail').style.display = 'block';
            
            // Показываем первый таб по умолчанию
            showTab('info');
            
            // Обновляем URL для возможности прямого доступа
            updateUrlWithTruckId(id);
        }
        
        // Обновляем URL с ID грузовика без перезагрузки страницы
        function updateUrlWithTruckId(id) {
            const newUrl = new URL(window.location.href);
            newUrl.searchParams.set('id', id);
            window.history.pushState({}, '', newUrl);
        }
        
        // Функция для рендеринга документов
        function renderDocuments(documents) {
            const documentList = document.getElementById('document-list');
            documentList.innerHTML = '';
            
            if (!documents || documents.length === 0) {
                documentList.innerHTML = '<p>Нет доступных документов</p>';
                return;
            }
            
            documents.forEach(doc => {
                documentList.innerHTML += `
                    <div class="document-item">
                        <div class="document-info">
                            <h4 class="document-title">${doc.title}</h4>
                            <p class="document-date">Действует с ${formatDate(doc.date)} по ${formatDate(doc.expiration)}</p>
                        </div>
                        <span class="document-status status-${doc.status}">${getDocumentStatusLabel(doc.status)}</span>
                        <div class="document-actions">
                            <button class="btn-document" onclick="viewDocument(${doc.id})">Просмотр</button>
                        </div>
                    </div>
                `;
            });
        }
        
        // Функция для рендеринга истории
        function renderHistory(history) {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            
            if (!history || history.length === 0) {
                historyList.innerHTML = '<p>Нет записей об обслуживании</p>';
                return;
            }
            
            history.forEach(item => {
                historyList.innerHTML += `
                    <div class="history-item">
                        <h4 class="history-date">${formatDate(item.date)}</h4>
                        <p class="history-description">${item.description}</p>
                    </div>
                `;
            });
        }
        
        // Функция для рендеринга галереи
        function renderGallery(photos) {
            const gallery = document.getElementById('truck-gallery');
            gallery.innerHTML = '';
            
            if (!photos || photos.length === 0) {
                gallery.innerHTML = '<p>Нет доступных фотографий</p>';
                return;
            }
            
            photos.forEach((photo, index) => {
                gallery.innerHTML += `
                    <div class="gallery-item" style="background-image: url('${photo}')" onclick="showFullSize('${photo}')">
                        <div class="preview-remove" onclick="event.stopPropagation(); removePhoto(${index})">×</div>
                    </div>
                `;
            });
        }
        
        // Функция переключения между табами
        function showTab(tabId) {
            // Скрываем все табы
            document.querySelectorAll('.truck-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Удаляем активный класс у всех вкладок
            document.querySelectorAll('.truck-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Показываем выбранный таб
            document.getElementById(`tab-${tabId}`).classList.add('active');
            
            // Добавляем активный класс выбранной вкладке
            document.querySelectorAll('.truck-tab').forEach(tab => {
                if (tab.textContent.toLowerCase().includes(tabId)) {
                    tab.classList.add('active');
                }
            });
        }
        
        // Функция возврата к списку
        function backToList() {
            document.getElementById('truck-list').style.display = 'grid';
            document.getElementById('truck-detail').style.display = 'none';
            currentTruckId = null;
            
            // Обновляем URL, удаляя параметр id
            const newUrl = new URL(window.location.href);
            newUrl.searchParams.delete('id');
            window.history.pushState({}, '', newUrl);
        }
        
        // Функция для редактирования грузовика
        function editTruck() {
            alert('Редактирование грузовика с ID: ' + currentTruckId);
            // Здесь будет реализовано открытие формы редактирования
        }
        
        // Функция для добавления документа
        function addDocument() {
            const docTitle = prompt('Введите название документа:');
            if (!docTitle) return;
            
            const docDateStr = prompt('Дата выдачи (ГГГГ-ММ-ДД):');
            if (!docDateStr) return;
            
            const docExpDateStr = prompt('Дата истечения (ГГГГ-ММ-ДД):');
            if (!docExpDateStr) return;
            
            // Создаем объект документа
            const newDoc = {
                title: docTitle,
                date: docDateStr,
                expiration: docExpDateStr,
                status: calculateDocStatus(docExpDateStr)
            };
            
            // Добавляем документ
            const result = window.TrucksModule.addDocument(currentTruckId, newDoc);
            
            if (result) {
                // Обновляем отображение документов
                const truck = window.TrucksModule.getTruckById(currentTruckId);
                renderDocuments(truck.documents);
                
                // Настраиваем уведомления для нового документа
                window.TrucksModule.setupDocumentNotifications();
            } else {
                alert('Ошибка при добавлении документа');
            }
        }
        
        // Функция для определения статуса документа
        function calculateDocStatus(expirationDateStr) {
            const today = new Date();
            const expDate = new Date(expirationDateStr);
            
            if (expDate < today) {
                return 'expired';
            }
            
            const diffTime = expDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 30) {
                return 'expiring';
            }
            
            return 'valid';
        }
        
        // Функция для просмотра документа
        function viewDocument(docId) {
            const truck = window.TrucksModule.getTruckById(currentTruckId);
            const doc = truck.documents.find(d => d.id === docId);
            
            if (doc) {
                alert(`
                    Документ: ${doc.title}
                    Дата выдачи: ${formatDate(doc.date)}
                    Действителен до: ${formatDate(doc.expiration)}
                    Статус: ${getDocumentStatusLabel(doc.status)}
                `);
            }
        }
        
        // Функция для добавления фотографий
        function addPhotos() {
            // Эта функция будет предлагать загрузить фото либо с устройства, либо вести URL
            const photoUrl = prompt('Введите URL фотографии грузовика:');
            
            if (!photoUrl) return;
            
            // Добавляем фото
            const result = window.TrucksModule.addPhoto(currentTruckId, photoUrl);
            
            if (result) {
                // Обновляем галерею
                const truck = window.TrucksModule.getTruckById(currentTruckId);
                renderGallery(truck.photos);
                
                // Кэшируем изображение для оффлайн-доступа
                window.TrucksModule.cacheImage(photoUrl)
                    .then(() => {
                        console.log('Изображение успешно кэшировано');
                    })
                    .catch(error => {
                        console.warn('Ошибка кэширования изображения:', error);
                    });
            } else {
                alert('Ошибка при добавлении фотографии');
            }
        }
        
        // Функция для удаления фотографии
        function removePhoto(index) {
            if (confirm('Вы уверены, что хотите удалить эту фотографию?')) {
                const result = window.TrucksModule.deletePhoto(currentTruckId, index);
                
                if (result) {
                    // Обновляем галерею
                    const truck = window.TrucksModule.getTruckById(currentTruckId);
                    renderGallery(truck.photos);
                } else {
                    alert('Ошибка при удалении фотографии');
                }
            }
        }
        
        // Функция для показа истории грузовика
        function showTruckHistory(id) {
            showTruckDetails(id);
            showTab('history');
        }
        
        // Функция для показа фотографии в полном размере
        function showFullSize(url) {
            // В реальном приложении здесь был бы лайтбокс или модальное окно
            window.open(url, '_blank');
        }
        
        // Вспомогательные функции
        function getStatusClass(status) {
            switch(status) {
                case 'active': return '';
                case 'idle': return 'status-idle';
                case 'maintenance': return 'status-maintenance';
                default: return '';
            }
        }
        
        function getStatusLabel(status) {
            switch(status) {
                case 'active': return 'В рейсе';
                case 'idle': return 'Простаивает';
                case 'maintenance': return 'На ТО';
                default: return 'Неизвестно';
            }
        }
        
        function getDocumentStatusLabel(status) {
            switch(status) {
                case 'valid': return 'Действителен';
                case 'expiring': return 'Истекает';
                case 'expired': return 'Просрочен';
                default: return 'Неизвестно';
            }
        }
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }
        
        // Функция возврата назад
        function goBack() {
            if (document.getElementById('truck-detail').style.display === 'block') {
                backToList();
            } else {
                window.location.href = 'index.html';
            }
        }
        
        // Инициализация приложения
        document.addEventListener('deviceready', function() {
            console.log('Приложение готово');
            // Настраиваем уведомления для документов
            if (window.TrucksModule) {
                window.TrucksModule.setupDocumentNotifications();
            }
        }, false);
    </script>
</body>
</html> 