# –û—Ç—á—ë—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–∞—Ä—Ç–æ–π –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è—Ö

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏ "–í–∫–ª—é—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ" –¥–ª—è –∞–¥–º–∏–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ**: –î–∞–∂–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ –∫–∞–∫ –∞–¥–º–∏–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–í–∫–ª—é—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ", –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —É –≤–æ–¥–∏—Ç–µ–ª–µ–π.

**–ü—Ä–∏—á–∏–Ω–∞**: 
- –£ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "–ê–¥–º–∏–Ω" –±—ã–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–æ–ª—å `DRIVER` –≤–º–µ—Å—Ç–æ `SUPERADMIN`
- –§—É–Ω–∫—Ü–∏—è `isDriver()` –ø—Ä–æ–≤–µ—Ä—è–ª–∞ —Ç–æ–ª—å–∫–æ —Ä–æ–ª—å `DRIVER`, –Ω–µ —É—á–∏—Ç—ã–≤–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–æ–ª–∏

**–†–µ—à–µ–Ω–∏–µ**:
1. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ä–æ–ª—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å `DRIVER` –Ω–∞ `SUPERADMIN`:
   ```sql
   UPDATE accounts_user SET role='SUPERADMIN' WHERE username='–ê–¥–º–∏–Ω';
   ```

2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `isDriver()` –≤ `core/templates/core/map.html`:
   ```javascript
   function isDriver() {
       const role = window.currentUserRole && window.currentUserRole.toUpperCase();
       return role === 'DRIVER' && !['SUPERADMIN', 'DIRECTOR', 'ADMIN'].includes(role);
   }
   
   function isAdmin() {
       const role = window.currentUserRole && window.currentUserRole.toUpperCase();
       return ['SUPERADMIN', 'DIRECTOR', 'ADMIN'].includes(role) || window.currentUserId === 1;
   }
   ```

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞ –∫–∞—Ä—Ç–µ –¥–ª—è –∞–¥–º–∏–Ω–∞

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∫ –∞–¥–º–∏–Ω –Ω–µ –≤–∏–¥–Ω–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞ –∫–∞—Ä—Ç–µ.

**–ê–Ω–∞–ª–∏–∑**:
- API `/api/driver_locations/` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–π –≤–æ–¥–∏—Ç–µ–ª–µ–π
- –õ–æ–≥–∏–∫–∞ –≤ `core/api.py` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —Ä–æ–ª—è–º:
  ```python
  if user.role in ['DIRECTOR', 'SUPERADMIN', 'ADMIN'] or user.is_superuser:
      locations = DriverLocation.objects.all().order_by('-timestamp')
  else:
      locations = DriverLocation.objects.filter(driver=user).order_by('-timestamp')
  ```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
2. JavaScript –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ª–æ–∫–∞—Ü–∏–π
3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ API

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
```
ID | Username | Role      | is_superuser
1  | –ê–¥–º–∏–Ω    | SUPERADMIN| 1
2  | arman    | DRIVER    | 0  
3  | driver1  | DRIVER    | 1
```

### –õ–æ–∫–∞—Ü–∏–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π:
```
ID | Latitude  | Longitude | Timestamp           | Driver_ID
1  | 43.238949 | 76.889709 | 2025-05-25 10:43:07 | 2
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
1. –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω (–ê–¥–º–∏–Ω/123) –Ω–∞ https://ee35-176-110-126-5.ngrok-free.app
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ä—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–Ω–æ–ø–∫–∏ "–í–∫–ª—é—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ"
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –≤–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞ –∫–∞—Ä—Ç–µ
   - –†–∞–±–æ—Ç—É API –≤ –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
curl -X POST https://ee35-176-110-126-5.ngrok-free.app/api/token/ \
  -H 'Content-Type: application/json' \
  -d '{"username":"–ê–¥–º–∏–Ω","password":"123"}'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞—Ü–∏–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://ee35-176-110-126-5.ngrok-free.app/api/driver_locations/
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–î–ª—è –±–æ–ª–µ–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–¥–∏—Ç–µ–ª–µ–π
2. –î–æ–±–∞–≤–∏—Ç—å –∏–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
–î–æ–±–∞–≤–∏—Ç—å –≤ JavaScript –∫–æ–¥ –∫–∞—Ä—Ç—ã:
```javascript
console.log('Current user role:', window.currentUserRole);
console.log('Current user ID:', window.currentUserId);
console.log('Is driver:', isDriver());
console.log('Is admin:', isAdmin());
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `loadDriverLocations()`:
```javascript
async function loadDriverLocations() {
    try {
        const resp = await fetch('/api/driver_locations/');
        if (!resp.ok) {
            console.error('API error:', resp.status, resp.statusText);
            return;
        }
        const data = await resp.json();
        console.log('driver_locations API response:', data);
        renderDriverMarkers(data);
        // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
    } catch (e) { 
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ driver_locations:', e); 
    }
}
```

### 3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
–î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞—Ü–∏–π –≤–æ–¥–∏—Ç–µ–ª–µ–π –¥–ª—è –∞–¥–º–∏–Ω–∞.

## –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è/–∞–¥–º–∏–Ω–∞**
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**
- üîÑ **–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä**
- üîÑ **–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –≤–æ–¥–∏—Ç–µ–ª–µ–π**

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ 